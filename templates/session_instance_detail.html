<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ session_instance.session_name }} - {{ session_instance.date }} - Irish Music Session</title>
</head>
<body>
    <h1>{{ session_instance.session_name }}</h1>
    <h2>{{ session_instance.date }}</h2>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div style="padding: 10px; margin: 10px 0; border: 1px solid #ccc; background-color: #f9f9f9;">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    {% if session_instance.comments %}
    <div class="session-instance-comments">
        <h3>Notes from this session:</h3>
        <p>{{ session_instance.comments }}</p>
    </div>
    {% endif %}
    
    {% if tune_sets %}
    <div>
        <h3>Tunes Played:</h3>
        <ul>
        {% for tune_set in tune_sets %}
            <li>
            {% for tune in tune_set -%}
                {%- if tune[2] -%} {# tune_id exists - create link #}
                    {%- set link = "https://thesession.org/tunes/" + tune[2]|string -%}
                    {%- if tune[4] -%} {# setting exists #}
                        {%- set link = link + "#setting" + tune[4]|string -%}
                    {%- endif -%}
                    <a href="{{ link }}" target="_blank">{{ tune[3] }}</a>
                {%- else -%} {# no tune_id - just show name #}
                    {{ tune[3] }}
                {%- endif -%}
                {%- if edit_mode and tune[2] -%}
                    <form method="POST" action="/sessions/{{ session_instance.session_path }}/{{ session_instance.date }}/delete_tune/{{ tune[2] }}/{{ tune[0] }}" style="display: inline; margin-left: 5px;">
                        <button type="submit" style="background: none; border: none; color: #dc3545; font-size: 0.8em; cursor: pointer; text-decoration: underline;" onclick="return confirm('Delete {{ tune[3] }}?')">[x]</button>
                    </form>
                {%- endif -%}
                {%- if not loop.last %}, {% endif -%}
            {%- endfor %}
            </li>
        {% endfor %}
        </ul>
        
        {% if edit_mode %}
        <div style="margin-top: 20px;">
            <form method="POST" action="/sessions/{{ session_instance.session_path }}/{{ session_instance.date }}/add_tune">
                <label for="tune_id">Add tune(s) by ID:</label>
                <input type="text" id="tune_id" name="tune_id" placeholder="Enter tune ID or comma-separated IDs (e.g., 123 or 123,456,789)" required style="margin: 0 10px; width: 300px;">
                <button type="submit">Add</button>
            </form>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div>
        <h3>Tunes Played:</h3>
        <p>No tunes recorded for this session yet.</p>
        
        {% if edit_mode %}
        <div style="margin-top: 20px;">
            <form method="POST" action="/sessions/{{ session_instance.session_path }}/{{ session_instance.date }}/add_tune">
                <label for="tune_id">Add tune(s) by ID:</label>
                <input type="text" id="tune_id" name="tune_id" placeholder="Enter tune ID or comma-separated IDs (e.g., 123 or 123,456,789)" required style="margin: 0 10px; width: 300px;">
                <button type="submit">Add</button>
            </form>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <div style="margin-top: 30px;">
        {% if edit_mode %}
            <a href="/sessions/{{ session_instance.session_path }}/{{ session_instance.date }}" style="background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">View</a>
        {% else %}
            <a href="/sessions/{{ session_instance.session_path }}/{{ session_instance.date }}?edit=true" style="background-color: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">Edit</a>
        {% endif %}
    </div>
    
    <p><a href="/sessions/{{ session_instance.session_path }}">‚Üê Back to this session</a></p>
</body>
</html>