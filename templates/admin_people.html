{% extends "base.html" %}

{% block title %}Admin - People{% endblock %}

{% block content %}
<div class="docs-content-inner">
    <div class="container">
        <article class="docs-article" id="section-1">
            <header class="docs-header">
                <h1 class="docs-heading">Admin Dashboard</h1>
                <section class="docs-intro">
                    <p>Manage user sessions and view system activity.</p>
                </section>
            </header>
            
            {% include 'admin_tabs.html' %}
            
            <section class="docs-section" id="people">
                <h2 class="section-heading">People ({{ people|length }})</h2>
                
                {% if people %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Location</th>
                                <th>TheSession.org</th>
                                <th>Username</th>
                                <th>Sessions</th>
                                <th>Instances</th>
                                <th>Latest Session</th>
                                <th>Last Login</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for person in people %}
                            <tr>
                                <td class="person-name">
                                    <a href="/admin/people/{{ person.person_id }}" class="person-link">{{ person.name }}</a>
                                </td>
                                <td class="person-location" title="{{ person.full_location }}">{{ person.city }}</td>
                                <td class="person-thesession">
                                    {% if person.thesession_user_id %}
                                        <a href="https://thesession.org/members/{{ person.thesession_user_id }}" target="_blank" rel="noopener noreferrer">
                                            {{ person.thesession_user_id }}
                                        </a>
                                    {% else %}
                                        <span class="text-muted">No member</span>
                                    {% endif %}
                                </td>
                                <td class="person-username">
                                    {% if person.username != 'No account' %}
                                        <strong>{{ person.username }}</strong>
                                        {% if person.is_system_admin %}
                                            <span class="admin-indicator">(admin)</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">{{ person.username }}</span>
                                    {% endif %}
                                </td>
                                <td class="person-session-count">
                                    {% if person.session_count > 0 %}
                                        <span class="badge bg-primary">{{ person.session_count }}</span>
                                    {% else %}
                                        <span class="text-muted">0</span>
                                    {% endif %}
                                </td>
                                <td class="person-instance-count">
                                    {% if person.session_instance_count > 0 %}
                                        <span class="badge bg-success">{{ person.session_instance_count }}</span>
                                    {% else %}
                                        <span class="text-muted">0</span>
                                    {% endif %}
                                </td>
                                <td class="person-latest-session">
                                    {% if person.latest_session_info != 'None' %}
                                        <span class="latest-session-info">{{ person.latest_session_info }}</span>
                                    {% else %}
                                        <span class="text-muted">None</span>
                                    {% endif %}
                                </td>
                                <td class="person-last-login">
                                    {% if person.last_login == 'Never' %}
                                        <span class="text-warning">{{ person.last_login }}</span>
                                    {% elif person.last_login == 'N/A' %}
                                        <span class="text-muted">{{ person.last_login }}</span>
                                    {% else %}
                                        {{ person.last_login }}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info" role="alert">
                    <h4 class="alert-heading">No People Found</h4>
                    <p>There are currently no people records in the system.</p>
                </div>
                {% endif %}
            </section>
        </article>
    </div>
</div>

<style>
.table {
    background-color: var(--bg-color);
    border-radius: 8px;
    box-shadow: 0 2px 4px var(--dropdown-shadow);
}

.table th {
    background-color: var(--hover-bg);
    border-top: none;
    font-weight: 600;
    color: var(--text-color);
}

.table-responsive {
    margin-top: 1rem;
}

.person-name {
    font-weight: 500;
}

.person-link {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
}

.person-link:hover {
    text-decoration: underline;
    color: var(--primary);
}


.person-location {
    font-size: 0.9rem;
    cursor: help;
    position: relative;
}

.person-thesession {
    font-size: 0.9rem;
}

.person-thesession a {
    color: var(--primary);
    text-decoration: none;
}

.person-thesession a:hover {
    text-decoration: underline;
}

.person-username {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.admin-indicator {
    color: var(--disabled-text);
    font-style: italic;
    font-weight: normal;
    margin-left: 0.5rem;
}

.person-last-login {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    white-space: nowrap;
}

.person-session-count,
.person-instance-count {
    text-align: center;
    font-size: 0.9rem;
}

.person-latest-session {
    font-size: 0.9rem;
    font-family: 'Courier New', monospace;
}

.latest-session-info {
    white-space: nowrap;
}

.badge {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
}

.alert {
    margin-top: 2rem;
}

@media (max-width: 768px) {
    .table-responsive {
        font-size: 0.85rem;
    }
    
    .person-username,
    .person-last-login {
        font-size: 0.8rem;
    }
    
    .person-location,
    .person-thesession,
    .person-latest-session {
        font-size: 0.8rem;
    }
    
    .person-session-count,
    .person-instance-count {
        font-size: 0.8rem;
    }
    
    .badge {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
    }
    
    /* Ensure mobile margin reduction matches other admin pages */
    body .docs-content {
        padding: 0.5rem !important;
    }
    
    body .docs-article {
        padding: 0.5rem !important;
    }
    
    body .docs-content-inner .container {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
        padding-top: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}
</style>
{% endblock %}