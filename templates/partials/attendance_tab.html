<!-- Attendance Tab Content -->
<div class="attendance-container">
    <div class="attendance-header mb-3">
        <div class="attendance-left-section">
            {% if is_session_admin or current_user.is_system_admin %}
            <!-- Search Bar for existing attendees -->
            <div class="attendance-search">
                <div class="input-group">
                    <input type="text" class="form-control" id="attendee-search" 
                           placeholder="Search and add people..." 
                           autocomplete="off">
                </div>
                <div id="search-results" class="search-results-dropdown"></div>
            </div>
            {% elif is_session_regular %}
            <div class="attendance-actions">
                <button class="btn btn-success btn-sm" id="quick-checkin-btn" onclick="window.attendanceManagerInstance && window.attendanceManagerInstance.quickCheckin()">
                    <i class="fas fa-check"></i> Check In
                </button>
            </div>
            {% endif %}
        </div>
        <div class="attendance-stats">
            <span class="badge badge-success attendance-filter-badge" data-filter="yes" style="cursor: pointer;">Yes: <span id="yes-count">0</span></span>
            <span class="badge badge-warning attendance-filter-badge" data-filter="maybe" style="cursor: pointer;">Maybe: <span id="maybe-count">0</span></span>
            <span class="badge badge-danger attendance-filter-badge" data-filter="no" style="cursor: pointer;">No: <span id="no-count">0</span></span>
            <span class="badge badge-primary attendance-filter-badge" data-filter="unknown" style="cursor: pointer;">Unknown: <span id="unknown-count">0</span></span>
            <span class="badge badge-secondary attendance-filter-badge" data-filter="" style="cursor: pointer;">Total: <span id="total-count">0</span></span>
        </div>
    </div>

    <!-- Attendance List -->
    <div class="attendance-list" id="attendance-list">
        <div class="text-center p-3">
            <i class="fas fa-spinner fa-spin"></i> Loading attendance...
        </div>
    </div>
</div>

<!-- Attendance Item Template -->
<template id="attendance-item-template">
    <div class="attendance-item" data-person-id="">
        <div class="attendance-info">
            <div class="person-name"></div>
            <div class="person-instruments text-muted small"></div>
        </div>
        <div class="attendance-controls">
            {% if is_session_admin %}
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-success attendance-status" data-status="yes">
                    ✓
                </button>
                <button type="button" class="btn btn-outline-warning attendance-status" data-status="maybe">
                    ?
                </button>
                <button type="button" class="btn btn-outline-danger attendance-status" data-status="no">
                    ✗
                </button>
            </div>
            {% if current_user.is_system_admin or is_session_admin %}
            <a href="" class="btn btn-sm btn-outline-primary ml-2 person-edit-link" title="Edit person details">
                <i class="fas fa-edit"></i> Edit
            </a>
            {% endif %}
            {% else %}
            <span class="attendance-status-display"></span>
            {% endif %}
        </div>
    </div>
</template>

{% if current_user.is_authenticated and (is_session_admin or is_session_regular) %}
<script>
// Initialize attendance management when the tab is loaded
document.addEventListener('DOMContentLoaded', function() {
    if (typeof AttendanceManager !== 'undefined') {
        window.attendanceManagerInstance = new AttendanceManager();
        window.attendanceManagerInstance.init({
            sessionInstanceId: {{ session_instance.session_instance_id|default('null') }},
            sessionId: {{ session_instance.session_id|default('null') }},
            sessionPath: '{{ session_instance.session_path|default('') }}',
            canManage: {{ (is_session_admin|default(false))|lower }},
            isRegular: {{ (is_session_regular|default(false))|lower }},
            currentUserId: {{ current_user.user_id if current_user.is_authenticated else 'null' }}
        });
    }
});
</script>
{% endif %}