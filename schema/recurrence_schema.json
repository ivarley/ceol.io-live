{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Session Recurrence Pattern",
  "description": "Schema for defining recurring session schedules",
  "type": "object",
  "required": ["schedules"],
  "properties": {
    "schedules": {
      "type": "array",
      "description": "Array of schedule patterns for this session",
      "items": {
        "oneOf": [
          {
            "type": "object",
            "description": "Weekly recurring schedule",
            "required": ["type", "weekday", "start_time", "end_time"],
            "properties": {
              "type": {
                "const": "weekly"
              },
              "weekday": {
                "type": "string",
                "enum": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"],
                "description": "Day of the week (lowercase)"
              },
              "start_time": {
                "type": "string",
                "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
                "description": "Start time in HH:MM format (24-hour)"
              },
              "end_time": {
                "type": "string",
                "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
                "description": "End time in HH:MM format (24-hour)"
              },
              "every_n_weeks": {
                "type": "integer",
                "minimum": 1,
                "default": 1,
                "description": "Interval in weeks (1 = every week, 2 = every other week, etc.)"
              }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "description": "Monthly schedule on nth occurrence of a weekday",
            "required": ["type", "weekday", "which", "start_time", "end_time"],
            "properties": {
              "type": {
                "const": "monthly_nth_weekday"
              },
              "weekday": {
                "type": "string",
                "enum": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"],
                "description": "Day of the week (lowercase)"
              },
              "which": {
                "type": "array",
                "items": {
                  "type": "integer",
                  "enum": [1, 2, 3, 4, -1],
                  "description": "1-4 for first through fourth occurrence, -1 for last occurrence"
                },
                "minItems": 1,
                "description": "Which occurrences of the weekday (e.g., [1, 3] for first and third)"
              },
              "start_time": {
                "type": "string",
                "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
                "description": "Start time in HH:MM format (24-hour)"
              },
              "end_time": {
                "type": "string",
                "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
                "description": "End time in HH:MM format (24-hour)"
              }
            },
            "additionalProperties": false
          }
        ]
      }
    }
  },
  "examples": [
    {
      "schedules": [
        {
          "type": "weekly",
          "weekday": "thursday",
          "start_time": "19:00",
          "end_time": "22:30",
          "every_n_weeks": 1
        }
      ]
    },
    {
      "schedules": [
        {
          "type": "monthly_nth_weekday",
          "weekday": "sunday",
          "which": [1, 3],
          "start_time": "16:00",
          "end_time": "20:00"
        }
      ]
    },
    {
      "schedules": [
        {
          "type": "weekly",
          "weekday": "tuesday",
          "start_time": "19:00",
          "end_time": "22:00",
          "every_n_weeks": 1
        },
        {
          "type": "weekly",
          "weekday": "sunday",
          "start_time": "15:00",
          "end_time": "18:00",
          "every_n_weeks": 1
        }
      ]
    },
    {
      "schedules": [
        {
          "type": "weekly",
          "weekday": "thursday",
          "start_time": "19:00",
          "end_time": "22:00",
          "every_n_weeks": 2
        }
      ]
    }
  ]
}
